# TODO
- [ ] convert scripts to packages to comform to conventions in scripts, for example:
```js
require('../src/setup_node_env');
require('@kbn/analyze_packages_readmes')
```
- [ ] Move documentation_analysis.md to packages
- [ ] Test
- [ ] open PR to commit the work
- [ ] Consider adding to CI as a quality check

# Kibana Documentation Analysis Scripts

This directory contains three different approaches to analyze the state and quality of README documentation across the Kibana codebase.

## Available Scripts

### Approach 1: Script-Based Analysis with Quality Scoring
**File:** `analyze_documentation.js`
**Description:** JavaScript script that provides balanced detail and performance with quality scoring.

**Features:**
- Analyzes README files across all package directories
- Generates quality scores based on content indicators
- Identifies generated/placeholder content
- Provides detailed statistics and examples

**Run with:**
```bash
# Basic analysis
node scripts/analyze_documentation.js

# Show help
node scripts/analyze_documentation.js --help

# Verbose output with more details
node scripts/analyze_documentation.js --verbose
```

### Approach 2: Shell-Based Analysis with Pattern Matching
**File:** `doc_analysis.sh`
**Description:** Fast shell script using find and grep for quick metrics.

**Features:**
- Fastest execution for quick metrics
- Uses native shell commands (find, grep, wc)
- Comprehensive package discovery via package.json detection
- Excludes test fixtures and build artifacts for accurate counts
- Detects "Empty package generated by @kbn/generate" patterns
- Provides accurate statistics and breakdowns
- Shows examples of packages without documentation

**Run with:**
```bash
# Basic analysis
./scripts/doc_analysis.sh

# Show help
./scripts/doc_analysis.sh --help

# Verbose output with more examples
./scripts/doc_analysis.sh --verbose
```

### Approach 3: AST-Based Analysis with Content Categorization
**File:** `advanced_doc_analysis.js`
**Description:** Sophisticated analysis with detailed content parsing and categorization.

**Features:**
- Most comprehensive analysis
- Categorizes packages by type (core, platform, solution, x-pack)
- Detailed content feature analysis
- Quality tier classification
- Feature breakdown (installation, usage, API, testing, contributing)

**Run with:**
```bash
# Full analysis
node scripts/advanced_doc_analysis.js

# Show help
node scripts/advanced_doc_analysis.js --help

# Verbose output with debug information
node scripts/advanced_doc_analysis.js --verbose
```

### Interactive Runner
**File:** `run_doc_analysis.sh`
**Description:** Interactive script to choose and run any of the above approaches.

**Run with:**
```bash
# Interactive menu
./scripts/run_doc_analysis.sh

# Show help
./scripts/run_doc_analysis.sh --help

# Interactive menu with verbose output
./scripts/run_doc_analysis.sh --verbose
```

## Output Examples

Each script provides different levels of detail:

### Approach 1 Output:
```
Kibana Documentation Analysis:
Total packages/plugins: 450
No README: 123 (27.3%)
Generated/Placeholder: 87 (19.3%)
Low Quality (â‰¤3): 156 (34.7%)
Medium Quality (4-6): 67 (14.9%)
High Quality (>6): 17 (3.8%)
```

### Approach 2 Output:
```
=== Kibana Documentation Analysis ===
Total packages/plugins found: 906
Packages without README.md: 211 (23.2%)
Generated/Placeholder READMEs: 70
Short READMEs (<100 words): 571
Comprehensive READMEs (>300 words + sections): 62

=== Quality Breakdown ===
No Documentation: 211
Generated/Placeholder: 70
Minimal Documentation: 571
Comprehensive Documentation: 62

=== Percentage Breakdown ===
No Documentation: 23.2%
Generated/Placeholder: 7.7%
Minimal Documentation: 63.0%
Comprehensive Documentation: 6.8%

=== Examples of packages without README.md ===
  - ./packages/kbn-babel-preset
  - ./packages/kbn-cli-dev-mode
  - ./packages/kbn-docs-utils
  ... and 201 more packages without README.md
```

### Approach 3 Output:
```
=== Detailed Kibana Documentation Analysis ===
Total packages analyzed: 450

=== Overall Quality Distribution ===
none: 123 (27.3%)
placeholder: 87 (19.3%)
basic: 156 (34.7%)
good: 67 (14.9%)
excellent: 17 (3.8%)

CORE (150 packages):
  none: 45 (30.0%)
  placeholder: 25 (16.7%)
  basic: 60 (40.0%)
  good: 15 (10.0%)
  excellent: 5 (3.3%)
```

## Prerequisites

- **Node.js**: Use the version specified in `.nvmrc` (no additional dependencies required)
- **bc calculator**: For shell script percentage calculations (usually pre-installed on macOS/Linux)
- **yarn kbn bootstrap**: Must be run first to set up the Kibana development environment

## Performance Comparison

| Approach | Speed | Detail Level | Use Case | Help Available |
|----------|-------|--------------|----------|----------------|
| Shell Script | Fastest (~5-10s) | Basic | Quick overview | `./scripts/doc_analysis.sh --help` |
| JavaScript Basic | Medium (~30-60s) | Detailed | Regular analysis | `node scripts/analyze_documentation.js --help` |
| JavaScript Advanced | Slower (~1-2min) | Comprehensive | Deep analysis | `node scripts/advanced_doc_analysis.js --help` |
| Interactive Runner | Variable | User Choice | Guided analysis | `./scripts/run_doc_analysis.sh --help` |

## Help System

All scripts now include comprehensive help functionality:

### Getting Help
```bash
# Show help for any script
./scripts/run_doc_analysis.sh --help
node scripts/analyze_documentation.js --help
node scripts/advanced_doc_analysis.js --help
./scripts/doc_analysis.sh --help
```

### Verbose Output
All scripts support a `--verbose` flag for additional detail:
```bash
# Get more detailed output
node scripts/analyze_documentation.js --verbose
node scripts/advanced_doc_analysis.js --verbose
./scripts/doc_analysis.sh --verbose
./scripts/run_doc_analysis.sh --verbose
```

### Help Features
- **Usage examples** with common command patterns
- **Feature descriptions** explaining what each script analyzes
- **Quality explanations** describing scoring systems and categories
- **Performance guidance** to help choose the right tool
- **Cross-references** to related scripts and approaches

## Analysis Scope

All scripts analyze packages and plugins by finding directories containing `package.json` files across:
- `packages/*` - Core Kibana packages
- `src/core/packages/*` - Core platform packages
- `src/platform/*` - Platform-level components  
- `x-pack/packages/*` - X-Pack packages
- `x-pack/platform/packages/*` - X-Pack platform packages
- `x-pack/solutions/*/packages/*` - Solution-specific packages
- `x-pack/solutions/*/plugins/*` - Solution-specific plugins

**Note:** Test fixtures, integration test directories, and build artifacts are automatically excluded from the analysis to ensure accurate package counts.

## Quality Indicators

The scripts look for various quality indicators:
- **Installation/Setup instructions**
- **Usage examples**
- **API documentation**
- **Testing information**
- **Contributing guidelines**
- **Architecture/design information**

## Generated Content Detection

All scripts detect generated or placeholder content by looking for patterns like:
- **"Empty package generated by @kbn/generate"** (primary pattern in Kibana)
- "This is a placeholder README"
- "TODO: Add documentation"
- "Generated by @kbn/plugin-generator"
- "Add your plugin description here"

**Note:** The shell script (Approach 2) has been specifically updated to accurately detect the Kibana-specific generated content pattern that appears in ~70 packages.

## Recent Improvements (Shell Script - Approach 2)

The shell-based analysis script has been significantly improved to provide more accurate results:

### Fixed Issues:
1. **Package Count Accuracy**: Now correctly identifies ~906 packages instead of the previous ~70 by finding all `package.json` files
2. **Percentage Calculations**: Fixed mathematical errors that caused percentages to exceed 100%
3. **Generated Content Detection**: Added proper detection for "Empty package generated by @kbn/generate" pattern
4. **Scope Filtering**: Excludes test fixtures, integration tests, and build artifacts for cleaner results

### Current Accurate Metrics:
- **Total Packages**: 906 (all actual packages/plugins)
- **No Documentation**: 23.2% (211 packages)
- **Generated/Placeholder**: 7.7% (70 packages with @kbn/generate pattern)
- **Minimal Documentation**: 63.0% (571 packages with <100 words)
- **Comprehensive Documentation**: 6.8% (62 packages with >300 words + sections)

## Customization

You can modify the search patterns, quality indicators, or output formats by editing the respective script files. Each script is well-commented to facilitate customization.
